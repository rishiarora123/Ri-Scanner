{% extends "base.html" %}

{% block title %}Dashboard - Ri-Scanner Pro{% endblock %}

{% block content %}
<div style="display: grid; grid-template-columns: 350px 1fr; gap: 2rem;">
    <!-- Sidebar / Stats -->
    <aside class="glass card" style="height: fit-content; position: sticky; top: 100px;">
        <h3 style="margin-top: 0; margin-bottom: 1rem;">Scan Status</h3>

        <!-- Phase Badge -->
        <div id="phase-badge" class="phase-badge idle">Idle</div>

        <!-- â”€â”€ FIX: Per-Phase Status Cards â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
        <!-- Shows each phase name, status (Pending/Running/Waiting/Complete),
             and summary stats. Driven by scan_status fields from the backend. -->
        <div id="phase-cards" style="margin-top: 1rem;">
            <div class="phase-card" id="phase1-card">
                <div class="phase-card-header">
                    <span>ğŸ” Phase 1: Discovery</span>
                    <span class="phase-status" id="phase1-status">Pending</span>
                </div>
                <div class="phase-card-detail" id="phase1-detail"></div>
            </div>
            <div class="phase-card" id="phase2-card">
                <div class="phase-card-header">
                    <span>ğŸ”¬ Phase 2: Intelligence</span>
                    <span class="phase-status" id="phase2-status">Pending</span>
                </div>
                <div class="phase-card-detail" id="phase2-detail"></div>
            </div>
            <div class="phase-card" id="phase4-card">
                <div class="phase-card-header">
                    <span>ğŸŒ Phase 4: ASN Expansion</span>
                    <span class="phase-status" id="phase4-status">Pending</span>
                </div>
                <div class="phase-card-detail" id="phase4-detail"></div>
            </div>
            <div class="phase-card" id="phase3-card">
                <div class="phase-card-header">
                    <span>ğŸ“¡ Phase 3: Infra Scan</span>
                    <span class="phase-status" id="phase3-status">Pending</span>
                </div>
                <div class="phase-card-detail" id="phase3-detail"></div>
            </div>
        </div>

        <!-- Summary Stats -->
        <div style="margin-top: 1rem; padding-top: 1rem; border-top: 1px solid var(--glass-border);">
            <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                <span style="color: var(--text-muted);">Subdomains Found</span>
                <span id="stat-subdomains" style="font-weight: 600;">0</span>
            </div>
            <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                <span style="color: var(--text-muted);">Live</span>
                <span id="stat-live" style="font-weight: 600; color: var(--success);">0</span>
            </div>
            <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                <span style="color: var(--text-muted);">Discoveries</span>
                <span id="stat-found" style="font-weight: 600; color: var(--primary);">0</span>
            </div>
        </div>
    </aside>

    <!-- Main Content -->
    <div>
        <!-- â”€â”€ FIX: User Prompt Panel â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
        <!-- Shown when scan is waiting for user confirmation between phases.
             Contains Continue/Stop buttons and Phase 3 strategy selector. -->
        <div id="user-prompt-panel" class="glass card"
            style="display: none; border: 2px solid var(--primary); margin-bottom: 1.5rem;">
            <div style="display: flex; align-items: center; gap: 0.75rem; margin-bottom: 1rem;">
                <span style="font-size: 1.8rem;">â¸ï¸</span>
                <div>
                    <h3 id="prompt-title" style="margin: 0; color: var(--primary);">Phase Complete</h3>
                    <p id="prompt-message"
                        style="margin: 0.25rem 0 0; color: var(--text-secondary); font-size: 0.95rem;"></p>
                </div>
            </div>

            <!-- Phase 3 Strategy Selector (only visible before Phase 3) -->
            <div id="strategy-selector"
                style="display: none; margin-bottom: 1rem; padding: 1rem; background: rgba(0,0,0,0.2); border-radius: var(--radius-md);">
                <h4 style="margin: 0 0 0.75rem; font-size: 0.95rem;">How do you want to run the infrastructure scan?
                </h4>
                <div style="display: flex; flex-direction: column; gap: 0.5rem;">
                    <label class="strategy-option">
                        <input type="radio" name="phase3_strategy" value="sequential" checked>
                        <span>Sequential (Masscan â†’ Naabu) <em style="color: var(--text-muted);">â€” Recommended,
                                stable</em></span>
                    </label>
                    <label class="strategy-option">
                        <input type="radio" name="phase3_strategy" value="masscan_only">
                        <span>Masscan only</span>
                    </label>
                    <label class="strategy-option">
                        <input type="radio" name="phase3_strategy" value="naabu_only">
                        <span>Naabu only</span>
                    </label>
                    <label class="strategy-option">
                        <input type="radio" name="phase3_strategy" value="parallel">
                        <span>Run both together <em style="color: var(--warning);">â€” Advanced, high resource
                                usage</em></span>
                    </label>
                </div>
            </div>

            <div style="display: flex; gap: 0.75rem;">
                <button id="btn-continue" onclick="continueScan()" class="btn btn-primary" style="flex: 1;">
                    â–¶ï¸ Continue to Next Phase
                </button>
                <button id="btn-stop-export" onclick="stopAndExport()" class="btn btn-outline"
                    style="flex: 1; border-color: var(--danger); color: var(--danger);">
                    â¹ï¸ Stop & Export
                </button>
            </div>
        </div>

        <!-- â”€â”€ FIX: Real-Time Infra Scan Progress â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
        <!-- Per-tool progress: Masscan chunk X/Y, %, ETA; Naabu status -->
        <div id="infra-progress-panel" class="glass card" style="display: none; margin-bottom: 1.5rem;">
            <h3 style="margin-top: 0;">ğŸ“¡ Infrastructure Scan Progress</h3>
            <div id="scan-strategy-label" style="font-size: 0.85rem; color: var(--text-muted); margin-bottom: 1rem;">
            </div>

            <!-- Masscan Progress -->
            <div class="tool-progress" id="masscan-progress-block">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;">
                    <span style="font-weight: 600;">ğŸ”´ Masscan</span>
                    <span id="masscan-status-badge" class="tool-status-badge">Pending</span>
                </div>
                <div class="progress-container" style="margin-bottom: 0.25rem;">
                    <div class="progress-bar" id="masscan-bar" style="width: 0%; transition: width 0.5s ease;"></div>
                </div>
                <div
                    style="display: flex; justify-content: space-between; font-size: 0.8rem; color: var(--text-muted);">
                    <span id="masscan-chunk-info">Chunk 0 / 0</span>
                    <span id="masscan-pct-info">0%</span>
                    <span id="masscan-eta-info">ETA: --</span>
                </div>
            </div>

            <!-- Naabu Progress -->
            <div class="tool-progress" id="naabu-progress-block" style="margin-top: 1rem;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;">
                    <span style="font-weight: 600;">ğŸŸ¢ Naabu</span>
                    <span id="naabu-status-badge" class="tool-status-badge">Pending</span>
                </div>
                <div class="progress-container" style="margin-bottom: 0.25rem;">
                    <div class="progress-bar" id="naabu-bar"
                        style="width: 0%; background: var(--success); transition: width 0.5s ease;"></div>
                </div>
                <div
                    style="display: flex; justify-content: space-between; font-size: 0.8rem; color: var(--text-muted);">
                    <span id="naabu-chunk-info">Chunk 0 / 0</span>
                    <span id="naabu-pct-info">0%</span>
                    <span id="naabu-eta-info">ETA: --</span>
                </div>
            </div>
        </div>

        <!-- Scan Logs -->
        <div class="glass card">
            <div class="flex-between mb-md">
                <h3 style="margin: 0;">ğŸ“‹ Live Scan Logs</h3>
                <div style="display: flex; gap: 0.5rem; align-items: center;">
                    <label style="display: flex; align-items: center; gap: 0.5rem; font-size: 0.9rem; cursor: pointer;">
                        <input type="checkbox" id="auto-scroll" checked> Auto-scroll
                    </label>
                    <button onclick="clearLogs()" class="btn btn-outline btn-sm">Clear</button>
                </div>
            </div>
            <div id="log-container"
                style="background: rgba(0,0,0,0.3); border-radius: var(--radius-md); padding: 1rem; max-height: 500px; overflow-y: auto; font-family: 'JetBrains Mono', monospace; font-size: 0.8rem; line-height: 1.6;">
                <div id="log-content" style="white-space: pre-wrap;">Waiting for scan to start...</div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<style>
    /* â”€â”€ FIX: Phase Card Styles â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .phase-card {
        padding: 0.6rem 0.75rem;
        margin-bottom: 0.4rem;
        background: rgba(255, 255, 255, 0.03);
        border-radius: var(--radius-sm, 6px);
        border-left: 3px solid var(--glass-border, #333);
        transition: all 0.3s ease;
    }

    .phase-card.running {
        border-left-color: var(--primary, #3b82f6);
        background: rgba(59, 130, 246, 0.08);
    }

    .phase-card.waiting {
        border-left-color: var(--warning, #f59e0b);
        background: rgba(245, 158, 11, 0.08);
    }

    .phase-card.complete {
        border-left-color: var(--success, #10b981);
        background: rgba(16, 185, 129, 0.06);
    }

    .phase-card.skipped {
        opacity: 0.5;
    }

    .phase-card-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        font-size: 0.85rem;
        font-weight: 500;
    }

    .phase-card-detail {
        font-size: 0.75rem;
        color: var(--text-muted, #999);
        margin-top: 0.25rem;
    }

    .phase-status {
        font-size: 0.7rem;
        padding: 0.15rem 0.5rem;
        border-radius: 10px;
        font-weight: 600;
        text-transform: uppercase;
    }

    .phase-status.pending {
        background: rgba(150, 150, 150, 0.2);
        color: #999;
    }

    .phase-status.running {
        background: rgba(59, 130, 246, 0.2);
        color: var(--primary);
    }

    .phase-status.waiting {
        background: rgba(245, 158, 11, 0.2);
        color: var(--warning);
    }

    .phase-status.complete {
        background: rgba(16, 185, 129, 0.2);
        color: var(--success);
    }

    /* â”€â”€ Strategy Selector â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .strategy-option {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        padding: 0.5rem 0.75rem;
        border-radius: var(--radius-sm, 6px);
        cursor: pointer;
        transition: background 0.2s;
        font-size: 0.9rem;
    }

    .strategy-option:hover {
        background: rgba(255, 255, 255, 0.05);
    }

    .strategy-option input[type="radio"] {
        accent-color: var(--primary);
    }

    /* â”€â”€ Tool Status Badge â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .tool-status-badge {
        font-size: 0.7rem;
        padding: 0.2rem 0.6rem;
        border-radius: 10px;
        font-weight: 600;
        text-transform: uppercase;
    }

    .tool-status-badge.running {
        background: rgba(59, 130, 246, 0.2);
        color: var(--primary);
    }

    .tool-status-badge.waiting {
        background: rgba(245, 158, 11, 0.2);
        color: var(--warning);
    }

    .tool-status-badge.completed {
        background: rgba(16, 185, 129, 0.2);
        color: var(--success);
    }

    .tool-status-badge.skipped {
        background: rgba(150, 150, 150, 0.2);
        color: #999;
    }

    .tool-status-badge.pending {
        background: rgba(150, 150, 150, 0.15);
        color: #888;
    }

    /* â”€â”€ Progress Bar â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .progress-container {
        height: 8px;
        background: rgba(255, 255, 255, 0.08);
        border-radius: 4px;
        overflow: hidden;
    }

    .progress-bar {
        height: 100%;
        background: var(--primary, #3b82f6);
        border-radius: 4px;
    }

    .tool-progress {
        padding: 0.75rem;
        background: rgba(0, 0, 0, 0.15);
        border-radius: var(--radius-md, 8px);
    }

    .phase-badge {
        display: inline-block;
        padding: 0.3rem 0.8rem;
        border-radius: 15px;
        font-size: 0.8rem;
        font-weight: 600;
    }

    .phase-badge.idle {
        background: rgba(150, 150, 150, 0.2);
        color: #999;
    }

    .phase-badge.running {
        background: rgba(59, 130, 246, 0.2);
        color: var(--primary);
    }

    .phase-badge.waiting {
        background: rgba(245, 158, 11, 0.2);
        color: var(--warning);
    }

    .phase-badge.stopped {
        background: rgba(239, 68, 68, 0.2);
        color: var(--danger);
    }
</style>

<script>
    let pollInterval = null;

    document.addEventListener('DOMContentLoaded', () => {
        pollInterval = setInterval(fetchStatus, 1500);
        fetchStatus();
        fetchLogs();
        setInterval(fetchLogs, 2000);
    });

    // â”€â”€ FIX: Continue Scan (release next phase gate) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    async function continueScan() {
        const btn = document.getElementById('btn-continue');
        btn.disabled = true;
        btn.innerText = 'â³ Starting...';

        const body = { action: 'continue' };

        // If the strategy selector is visible (Phase 3 gate), include strategy
        const strategyPanel = document.getElementById('strategy-selector');
        if (strategyPanel.style.display !== 'none') {
            const selected = document.querySelector('input[name="phase3_strategy"]:checked');
            if (selected) body.phase3_strategy = selected.value;
        }

        try {
            await fetch('/continue_scan', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(body)
            });
        } catch (e) {
            console.error('Continue failed:', e);
        }

        btn.disabled = false;
        btn.innerText = 'â–¶ï¸ Continue to Next Phase';
    }

    // â”€â”€ FIX: Stop & Export â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    async function stopAndExport() {
        if (!confirm('Stop the scan and export current results?')) return;
        try {
            await fetch('/continue_scan', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ action: 'stop' })
            });
        } catch (e) {
            console.error('Stop failed:', e);
        }
    }

    // â”€â”€ FIX: Status Polling â€” drives entire Dashboard UI â”€â”€â”€â”€â”€â”€â”€â”€â”€
    async function fetchStatus() {
        try {
            const res = await fetch('/get_status');
            const s = await res.json();
            updateDashboard(s);
        } catch (e) {
            console.error('Status poll error:', e);
        }
    }

    function updateDashboard(s) {
        const phase = s.phase || 'Idle';
        const badge = document.getElementById('phase-badge');
        badge.innerText = phase;

        // Badge class
        badge.className = 'phase-badge';
        if (phase.includes('Waiting') || s.waiting_for_user) badge.classList.add('waiting');
        else if (phase === 'Idle' || phase === 'Stopped' || phase.includes('Stopping')) badge.classList.add(phase === 'Idle' ? 'idle' : 'stopped');
        else badge.classList.add('running');

        // Summary stats
        document.getElementById('stat-subdomains').innerText = s.phase1_subdomains_total || 0;
        document.getElementById('stat-live').innerText = s.phase1_live || 0;
        document.getElementById('stat-found').innerText = s.found_count || 0;

        // â”€â”€ Phase Cards â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        updatePhaseCard('phase1', s, phase);
        updatePhaseCard('phase2', s, phase);
        updatePhaseCard('phase4', s, phase);
        updatePhaseCard('phase3', s, phase);

        // â”€â”€ User Prompt Panel â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        const promptPanel = document.getElementById('user-prompt-panel');
        const strategySelector = document.getElementById('strategy-selector');

        if (s.waiting_for_user) {
            promptPanel.style.display = 'block';
            const nextPhase = s.next_phase || 'Next Phase';
            document.getElementById('prompt-title').innerText = phase.replace('â¸ï¸ ', '');
            document.getElementById('prompt-message').innerText = `Do you want to continue to ${nextPhase} or stop and export results?`;
            document.getElementById('btn-continue').innerText = `â–¶ï¸ Continue to ${nextPhase}`;

            // Show strategy selector only before Phase 3
            if (s.current_gate === 'gate_phase3') {
                strategySelector.style.display = 'block';
            } else {
                strategySelector.style.display = 'none';
            }
        } else {
            promptPanel.style.display = 'none';
        }

        // â”€â”€ Infra Scan Progress Panel â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        const infraPanel = document.getElementById('infra-progress-panel');
        if (s.masscan_total > 0 || s.naabu_total > 0) {
            infraPanel.style.display = 'block';
            document.getElementById('scan-strategy-label').innerText = `Strategy: ${(s.phase3_strategy || 'sequential').replace('_', ' ')}`;

            // Masscan
            updateToolProgress('masscan', s);
            // Naabu
            updateToolProgress('naabu', s);
        } else if (phase === 'Idle' || phase === 'Stopped') {
            infraPanel.style.display = 'none';
        }
    }

    function updatePhaseCard(phaseKey, s, currentPhase) {
        const card = document.getElementById(`${phaseKey}-card`);
        const statusEl = document.getElementById(`${phaseKey}-status`);
        const detailEl = document.getElementById(`${phaseKey}-detail`);

        // Determine card state
        let state = 'pending';
        let detail = '';

        if (phaseKey === 'phase1') {
            if (s.phase1_complete) {
                state = 'complete';
                const tools = (s.phase1_tools_used || []).join(', ') || 'N/A';
                detail = `${s.phase1_subdomains_total || 0} total, ${s.phase1_live || 0} live Â· Tools: ${tools}`;
            } else if (currentPhase.includes('Phase 1') || currentPhase.includes('Discovery')) {
                state = 'running';
                // FIX: Show which tool is currently running and running totals
                const curTool = s.phase1_current_tool || '';
                const total = s.phase1_subdomains_total || 0;
                detail = curTool ? `Running: ${curTool} Â· ${total} found so far` : `${total} found so far`;
            }
        } else if (phaseKey === 'phase2') {
            if (s.phase2_complete) {
                state = 'complete';
                detail = `${s.phase2_total || 0} subdomains scanned`;
            } else if (currentPhase.includes('Phase 2') || currentPhase.includes('Intelligence')) {
                state = 'running';
                // FIX: Show live completion count
                const done = s.phase2_completed || 0;
                const total = s.phase2_total || 0;
                if (total > 0) {
                    detail = `${done} / ${total} subdomains scanned`;
                }
            } else if (s.waiting_for_user && s.current_gate === 'gate_phase2') {
                state = 'pending';
            }
        } else if (phaseKey === 'phase4') {
            if (s.phase4_complete) {
                state = 'complete';
                // FIX: Show actual ASN expansion stats
                const ranges = s.phase4_ranges_added || 0;
                const directIps = s.phase4_direct_ips || 0;
                detail = `${s.phase4_asn_count || 0} ASNs Â· ${ranges} ranges + ${directIps} direct IPs`;
            } else if (currentPhase.includes('Phase 4') || currentPhase.includes('ASN')) {
                state = 'running';
                detail = `${s.phase4_asn_count || 0} ASNs found`;
            }
        } else if (phaseKey === 'phase3') {
            if (currentPhase.includes('Scanning') || currentPhase.includes('Phase 3')) {
                state = 'running';
                const mPct = s.masscan_pct || 0;
                const nPct = s.naabu_pct || 0;
                detail = `Masscan: ${mPct}% | Naabu: ${nPct}%`;
            } else if (currentPhase.includes('Consolidating') || currentPhase === 'Idle') {
                if (s.masscan_total > 0 || s.naabu_total > 0) {
                    state = 'complete';
                }
            }
        }

        // Apply
        card.className = `phase-card ${state}`;
        statusEl.className = `phase-status ${state}`;
        statusEl.innerText = state.charAt(0).toUpperCase() + state.slice(1);
        if (s.waiting_for_user &&
            ((phaseKey === 'phase1' && s.current_gate === 'gate_phase2') ||
                (phaseKey === 'phase2' && s.current_gate === 'gate_phase4') ||
                (phaseKey === 'phase4' && s.current_gate === 'gate_phase3'))) {
            // The completed phase shows "Waiting" badge
            statusEl.className = 'phase-status waiting';
            statusEl.innerText = 'Waiting';
            card.className = 'phase-card waiting';
        }
        detailEl.innerText = detail;
    }

    function updateToolProgress(tool, s) {
        const status = s[`${tool}_status`] || 'Pending';
        const progress = s[`${tool}_progress`] || 0;
        const total = s[`${tool}_total`] || 0;
        const pct = s[`${tool}_pct`] || 0;
        const eta = s[`${tool}_eta`] || '--';

        // Status badge
        const badge = document.getElementById(`${tool}-status-badge`);
        badge.innerText = status;
        badge.className = `tool-status-badge ${status.toLowerCase().split(' ')[0]}`;

        // Progress bar
        document.getElementById(`${tool}-bar`).style.width = `${pct}%`;

        // Text info
        document.getElementById(`${tool}-chunk-info`).innerText = `Chunk ${progress} / ${total}`;
        document.getElementById(`${tool}-pct-info`).innerText = `${pct}%`;
        document.getElementById(`${tool}-eta-info`).innerText = `ETA: ${eta}`;
    }

    // â”€â”€ Log Polling â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    async function fetchLogs() {
        try {
            const res = await fetch('/get_logs');
            const data = await res.json();
            const logContent = document.getElementById('log-content');
            if (data.logs && data.logs.length > 0) {
                logContent.innerText = data.logs.join('\n');
                if (document.getElementById('auto-scroll').checked) {
                    const container = document.getElementById('log-container');
                    container.scrollTop = container.scrollHeight;
                }
            }
        } catch (e) {
            console.error('Log poll error:', e);
        }
    }

    function clearLogs() {
        document.getElementById('log-content').innerText = 'Logs cleared.';
    }
</script>
{% endblock %}